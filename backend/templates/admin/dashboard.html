{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
    .dashboard-container {
        padding: 20px;
    }
    
    .dashboard-header {
        margin-bottom: 30px;
    }
    
    .dashboard-header h1 {
        font-size: 32px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }
    
    .dashboard-nav {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    
    .dashboard-nav-btn {
        padding: 8px 16px;
        background: #417690;
        color: white;
        text-decoration: none;
        border-radius: 4px;
        transition: background 0.3s;
    }
    
    .dashboard-nav-btn:hover {
        background: #2c5263;
    }
    
    /* í†µê³„ ì¹´ë“œ */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .stat-card-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .stat-icon {
        font-size: 32px;
    }
    
    .stat-title {
        font-size: 14px;
        color: #666;
        font-weight: 600;
    }
    
    .stat-value {
        font-size: 36px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }
    
    .stat-details {
        font-size: 12px;
        color: #999;
    }
    
    .stat-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: bold;
        margin-right: 5px;
    }
    
    .badge-success { background: #28a745; color: white; }
    .badge-info { background: #007bff; color: white; }
    .badge-warning { background: #ffc107; color: black; }
    .badge-danger { background: #dc3545; color: white; }
    
    /* ì°¨íŠ¸ ì˜ì—­ */
    .chart-container {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .chart-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
    }
    
    /* í…Œì´ë¸” */
    .dashboard-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }
    
    .dashboard-table th {
        background: #f8f9fa;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }
    
    .dashboard-table td {
        padding: 12px;
        border-bottom: 1px solid #dee2e6;
    }
    
    .dashboard-table tr:hover {
        background: #f8f9fa;
    }
    
    /* ìµœê·¼ í™œë™ */
    .activity-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .activity-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 12px;
        border-bottom: 1px solid #eee;
    }
    
    .activity-item:hover {
        background: #f8f9fa;
    }
    
    .activity-icon {
        font-size: 24px;
    }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-title {
        font-weight: 500;
        color: #333;
    }
    
    .activity-date {
        font-size: 12px;
        color: #999;
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- í—¤ë” -->
    <div class="dashboard-header">
        <h1>ğŸ“Š í†µí•© ëŒ€ì‹œë³´ë“œ</h1>
        <p style="color: #666;">ì „ì²´ ì‹œìŠ¤í…œ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
    </div>
    
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="dashboard-nav">
        <a href="{% url 'admin:index' %}" class="dashboard-nav-btn">ëŒ€ì‹œë³´ë“œ í™ˆ</a>
        <a href="{% url 'admin:dashboard_daily' %}" class="dashboard-nav-btn">ì¼ë³„ í†µê³„</a>
        <a href="{% url 'admin:dashboard_monthly' %}" class="dashboard-nav-btn">ì›”ë³„ í†µê³„</a>
        <a href="{% url 'admin:dashboard_stats' %}" class="dashboard-nav-btn">ìƒì„¸ í†µê³„</a>
    </div>
    
    <!-- í•µì‹¬ í†µê³„ ì¹´ë“œ -->
    <div class="stats-grid">
        <!-- ì‚¬ìš©ì í†µê³„ -->
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">ğŸ‘¥</span>
                <span class="stat-title">ì´ ì‚¬ìš©ì</span>
            </div>
            <div class="stat-value">{{ user_stats.total|default:0 }}</div>
            <div class="stat-details">
                <span class="stat-badge badge-success">âœ“ í™œì„± {{ user_stats.active|default:0 }}</span>
                <span class="stat-badge badge-info">ğŸ“§ ì¸ì¦ {{ user_stats.verified|default:0 }}</span>
                <br>
                <small>ì˜¤ëŠ˜ ê°€ì…: <strong>{{ user_stats.today|default:0 }}</strong></small>
            </div>
        </div>
        
        <!-- ë¬¸ì˜ í†µê³„ -->
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">ğŸ“</span>
                <span class="stat-title">ì´ ë¬¸ì˜</span>
            </div>
            <div class="stat-value">{{ inquiry_stats.total|default:0 }}</div>
            <div class="stat-details">
                <span class="stat-badge badge-warning">â³ ëŒ€ê¸° {{ inquiry_stats.pending|default:0 }}</span>
                <span class="stat-badge badge-info">ğŸ” ê²€í†  {{ inquiry_stats.reviewing|default:0 }}</span>
                <br>
                <span class="stat-badge badge-success">âœ“ í™•ì • {{ inquiry_stats.confirmed|default:0 }}</span>
                <span class="stat-badge badge-success">âœ… ì™„ë£Œ {{ inquiry_stats.completed|default:0 }}</span>
            </div>
        </div>
        
        <!-- ì œí’ˆ í†µê³„ -->
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">ğŸ“¦</span>
                <span class="stat-title">ì œí’ˆ & ì˜ìƒ</span>
            </div>
            <div class="stat-value">{{ product_stats.products.total|default:0 }}</div>
            <div class="stat-details">
                <span class="stat-badge badge-info">â­ ë¦¬ë·° {{ product_stats.reviews.total|default:0 }}</span>
                <span class="stat-badge badge-warning">ğŸ¥ ì˜ìƒ {{ product_stats.videos.total|default:0 }}</span>
                <br>
                <small>í‰ê·  í‰ì : <strong>{{ product_stats.reviews.avg_rating|default:0 }}ì </strong></small>
            </div>
        </div>
        
        <!-- ê°¤ëŸ¬ë¦¬ í†µê³„ -->
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">ğŸ¨</span>
                <span class="stat-title">ê°¤ëŸ¬ë¦¬</span>
            </div>
            <div class="stat-value">{{ gallery_stats.total|default:0 }}</div>
            <div class="stat-details">
                <span class="stat-badge badge-info">ğŸ¨ ì‘í’ˆ {{ gallery_stats.works|default:0 }}</span>
                <span class="stat-badge badge-success">ğŸ’¬ í›„ê¸° {{ gallery_stats.reviews|default:0 }}</span>
                <br>
                <small>ì´ ì¡°íšŒ: <strong>{{ gallery_stats.engagement.total_views|default:0 }}</strong></small>
            </div>
        </div>
        
        <!-- ì»¤ë¦¬í˜ëŸ¼ í†µê³„ -->
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">ğŸ“š</span>
                <span class="stat-title">ì»¤ë¦¬í˜ëŸ¼</span>
            </div>
            <div class="stat-value">{{ curriculum_stats.curriculums|default:0 }}</div>
            <div class="stat-details">
                <span class="stat-badge badge-info">ğŸ“ í”„ë¡œì íŠ¸ {{ curriculum_stats.projects|default:0 }}</span>
                <span class="stat-badge badge-warning">ğŸ“ ëª¨ë“ˆ {{ curriculum_stats.modules|default:0 }}</span>
                <br>
                <small>ìë£Œ: <strong>{{ curriculum_stats.materials|default:0 }}ê°œ</strong></small>
            </div>
        </div>
        
        <!-- ì¼ì • í†µê³„ -->
        <div class="stat-card">
            <div class="stat-card-header">
                <span class="stat-icon">ğŸ“…</span>
                <span class="stat-title">ìˆ˜ì—… ì¼ì •</span>
            </div>
            <div class="stat-value">{{ inquiry_stats.schedules.total|default:0 }}</div>
            <div class="stat-details">
                <span class="stat-badge badge-success">âœ“ ê°€ëŠ¥ {{ inquiry_stats.schedules.available|default:0 }}</span>
                <span class="stat-badge badge-danger">âš  ë§Œì„ {{ inquiry_stats.schedules.full|default:0 }}</span>
            </div>
        </div>
    </div>
    
    <!-- ì¼ë³„ í†µê³„ ì°¨íŠ¸ -->
    <div class="chart-container">
        <h2 class="chart-title">ğŸ“ˆ ìµœê·¼ 7ì¼ í™œë™ ì¶”ì´</h2>
        <canvas id="dailyChart" height="80"></canvas>
    </div>
    
    <!-- ëª¨ë¸ë³„ ë°ì´í„° í˜„í™© -->
    <div class="chart-container">
        <h2 class="chart-title">ğŸ“‹ ì „ì²´ ëª¨ë¸ë³„ ë°ì´í„° í˜„í™©</h2>
        <table class="dashboard-table">
            <thead>
                <tr>
                    <th>ì•±</th>
                    <th>ëª¨ë¸</th>
                    <th>ë°ì´í„° ìˆ˜</th>
                    <th>ìƒíƒœ</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="1"><strong>ğŸ‘¥ Accounts</strong></td>
                    <td>ì‚¬ìš©ì (Users)</td>
                    <td><strong>{{ model_counts.accounts.users|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td rowspan="2"><strong>ğŸ“ Inquiry</strong></td>
                    <td>ë¬¸ì˜ (Inquiries)</td>
                    <td><strong>{{ model_counts.inquiry.inquiries|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td>ì¼ì • (Schedules)</td>
                    <td><strong>{{ model_counts.inquiry.schedules|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td rowspan="4"><strong>ğŸ“¦ Products</strong></td>
                    <td>ì œí’ˆ (Products)</td>
                    <td><strong>{{ model_counts.products.products|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td>ë¦¬ë·° (Reviews)</td>
                    <td><strong>{{ model_counts.products.reviews|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td>ì˜ìƒ (Videos)</td>
                    <td><strong>{{ model_counts.products.videos|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td>ìˆ˜ì—…ì‚¬ì§„ (Photos)</td>
                    <td><strong>{{ model_counts.products.photos|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td rowspan="2"><strong>ğŸ¨ Gallery</strong></td>
                    <td>í•™ìƒ ì‘í’ˆ (Student Works)</td>
                    <td><strong>{{ model_counts.gallery.works|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td>ìˆ˜ì—… í›„ê¸° (Class Reviews)</td>
                    <td><strong>{{ model_counts.gallery.reviews|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td rowspan="4"><strong>ğŸ“š Curriculum</strong></td>
                    <td>ì»¤ë¦¬í˜ëŸ¼</td>
                    <td><strong>{{ model_counts.curriculum.curriculums|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td>í”„ë¡œì íŠ¸</td>
                    <td><strong>{{ model_counts.curriculum.projects|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td>ëª¨ë“ˆ</td>
                    <td><strong>{{ model_counts.curriculum.modules|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td>ìë£Œ</td>
                    <td><strong>{{ model_counts.curriculum.materials|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td rowspan="3"><strong>ğŸ  Home</strong></td>
                    <td>íˆì–´ë¡œ ìŠ¬ë¼ì´ë“œ</td>
                    <td><strong>{{ model_counts.home.hero_slides|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
                <tr>
                    <td>íŠ¹ì§•</td>
                    <td><strong>{{ model_counts.home.features|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-info">ìš´ì˜ì¤‘</span></td>
                </tr>
                <tr>
                    <td>í•˜ì´ë¼ì´íŠ¸</td>
                    <td><strong>{{ model_counts.home.highlights|default:0 }}</strong></td>
                    <td><span class="stat-badge badge-success">í™œì„±</span></td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- ìµœê·¼ í™œë™ -->
    <div class="chart-container">
        <h2 class="chart-title">ğŸ”” ìµœê·¼ í™œë™ ë‚´ì—­</h2>
        <ul class="activity-list">
            {% for activity in recent_activities|slice:":10" %}
            <li class="activity-item">
                <span class="activity-icon">{{ activity.icon }}</span>
                <div class="activity-content">
                    <div class="activity-title">{{ activity.title }}</div>
                    <div class="activity-date">{{ activity.date|date:"Y-m-d H:i" }}</div>
                </div>
            </li>
            {% empty %}
            <li class="activity-item">
                <span class="activity-icon">â„¹ï¸</span>
                <div class="activity-content">
                    <div class="activity-title">ìµœê·¼ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
    // ì¼ë³„ í†µê³„ ì°¨íŠ¸
    const dailyCtx = document.getElementById('dailyChart').getContext('2d');
    const dailyChart = new Chart(dailyCtx, {
        type: 'line',
        data: {
            labels: [
                {% for stat in daily_stats %}
                '{{ stat.date_kr }}'{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            datasets: [{
                label: 'ì‹ ê·œ ì‚¬ìš©ì',
                data: [
                    {% for stat in daily_stats %}
                    {{ stat.users }}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'ì‹ ê·œ ë¬¸ì˜',
                data: [
                    {% for stat in daily_stats %}
                    {{ stat.inquiries }}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                ],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
</script>
{% endblock %}
